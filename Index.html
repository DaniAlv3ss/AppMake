<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vitória Camilli Makeup</title>

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue3-apexcharts@1.4.1/dist/vue3-apexcharts.js"></script>
    
    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Configuração do Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        rose: { 50: '#fff1f2', 100: '#ffe4e6', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c' }
                    }
                }
            }
        }
    </script>

    <!-- INCLUIR CSS -->
    <?!= include('CSS'); ?>
</head>
<body class="text-slate-800 antialiased bg-slate-50">

    <div id="app" v-cloak class="h-screen flex flex-col md:flex-row overflow-hidden">
        
        <!-- LOADING OVERLAY -->
        <transition name="fade">
            <div v-if="loading" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center text-rose-600">
                <div class="w-12 h-12 border-4 border-current border-t-transparent rounded-full animate-spin mb-4"></div>
                <span class="font-medium animate-pulse">Carregando Sistema...</span>
            </div>
        </transition>

        <!-- BACKDROP MOBILE (Para fechar o menu lateral) -->
        <transition name="fade">
            <div v-if="sidebarOpen" @click="sidebarOpen = false" class="fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm"></div>
        </transition>

        <!-- SIDEBAR -->
        <aside :class="['fixed md:static inset-y-0 left-0 z-50 w-72 md:w-64 bg-white border-r border-slate-200 transition-transform duration-300 ease-in-out flex flex-col shadow-2xl md:shadow-none', sidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0']">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-rose-50/50">
                <div>
                    <h1 class="text-xl font-bold text-rose-600 flex items-center gap-2">
                        <i class="ri-palette-line text-2xl"></i> Vitória Camilli
                    </h1>
                    <p class="text-[10px] text-slate-400 font-bold tracking-widest uppercase mt-1 pl-8">Makeup Manager</p>
                </div>
                <button @click="sidebarOpen = false" class="md:hidden w-10 h-10 flex items-center justify-center bg-white rounded-xl shadow-sm text-slate-400 hover:text-rose-500 transition-colors border border-slate-100">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>

            <nav class="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                <button v-for="item in menuItems" :key="item.id" 
                    @click="setPage(item.id)"
                    :class="['w-full flex items-center gap-3 px-4 py-3.5 rounded-xl font-medium transition-all duration-200 group relative', 
                             view === item.id ? 'bg-rose-50 text-rose-700 shadow-sm' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-900']">
                    <div v-if="view === item.id" class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-rose-500 rounded-r-full"></div>
                    <i :class="[item.icon, 'text-xl transition-transform', view === item.id ? 'scale-110' : 'group-hover:scale-110']"></i>
                    {{ item.label }}
                </button>
            </nav>

            <div class="p-4 border-t border-slate-100 bg-slate-50">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-rose-500 to-orange-400 flex items-center justify-center text-white font-bold shadow-md text-sm">VC</div>
                    <div class="overflow-hidden">
                        <p class="text-sm font-bold text-slate-900 truncate">Vitória Camilli</p>
                        <p class="text-xs text-slate-500 truncate">Profissional</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col h-full relative w-full">
            
            <!-- HEADER MOBILE -->
            <header class="md:hidden bg-white px-4 py-3 border-b border-slate-200 flex justify-between items-center sticky top-0 z-30 shadow-sm">
                <div class="flex items-center gap-3">
                    <button @click="sidebarOpen = true" class="w-10 h-10 flex items-center justify-center text-slate-600 hover:bg-slate-50 rounded-xl transition-colors border border-slate-100 shadow-sm">
                        <i class="ri-menu-line text-xl"></i>
                    </button>
                    <span class="font-bold text-lg text-slate-800">{{ getPageTitle() }}</span>
                </div>
                <button @click="openApptModal(null)" class="w-10 h-10 bg-rose-600 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-90 transition-transform">
                    <i class="ri-add-line text-xl"></i>
                </button>
            </header>

            <!-- SCROLLABLE CONTENT -->
            <div class="flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-8 custom-scrollbar pb-24 md:pb-8 relative">
                
                <transition name="slide-up" mode="out-in">
                    
                    <!-- VIEW: DASHBOARD -->
                    <div v-if="view === 'dashboard'" key="dashboard" class="space-y-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-bold text-slate-900 hidden md:block">Visão Geral</h2>
                                <p class="text-sm text-slate-500 hidden md:block">Bem-vinda de volta!</p>
                            </div>
                            <div class="w-full md:w-auto flex flex-col md:flex-row gap-2">
                                <div class="flex gap-2 w-full">
                                    <select v-model="filters.period" class="flex-1 bg-white border border-slate-300 text-slate-700 text-sm rounded-xl focus:ring-rose-500 focus:border-rose-500 p-2.5 shadow-sm outline-none h-12 md:h-auto">
                                        <option value="today">Hoje</option>
                                        <option value="week">Esta Semana</option>
                                        <option value="month">Este Mês</option>
                                    </select>
                                    <button @click="openWhatsappReport" class="flex-none w-12 md:w-10 h-12 md:h-10 flex items-center justify-center bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 shadow-md transition-colors" title="Enviar Resumo">
                                        <i class="ri-whatsapp-line text-xl"></i>
                                    </button>
                                </div>
                                <button @click="openApptModal(null)" class="hidden md:flex bg-slate-900 text-white px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-800 shadow-lg items-center gap-2 whitespace-nowrap transition-transform active:scale-95">
                                    <i class="ri-add-line text-lg"></i> Novo Agendamento
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gradient-to-br from-rose-500 to-pink-600 p-6 rounded-2xl shadow-lg shadow-rose-200 text-white relative overflow-hidden group">
                                <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-xl group-hover:scale-110 transition-transform"></div>
                                <div class="absolute right-4 top-4 opacity-50"><i class="ri-money-dollar-circle-line text-3xl"></i></div>
                                <p class="text-rose-100 text-sm font-medium relative z-10">Faturamento</p>
                                <h3 class="text-3xl font-bold mt-1 relative z-10">{{ formatCurrency(dashboardStats.revenue) }}</h3>
                            </div>
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-slate-500 text-sm font-medium">Lucro Líquido</p>
                                    <div class="w-8 h-8 bg-emerald-50 text-emerald-600 rounded-lg flex items-center justify-center"><i class="ri-funds-line"></i></div>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-900">{{ formatCurrency(dashboardStats.profit) }}</h3>
                            </div>
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-slate-500 text-sm font-medium">Atendimentos</p>
                                    <div class="w-8 h-8 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center"><i class="ri-user-smile-line"></i></div>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-900">{{ dashboardStats.count }}</h3>
                            </div>
                            <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="text-slate-500 text-sm font-medium">A Receber</p>
                                    <div class="w-8 h-8 bg-amber-50 text-amber-600 rounded-lg flex items-center justify-center"><i class="ri-wallet-3-line"></i></div>
                                </div>
                                <h3 class="text-2xl font-bold text-slate-900">{{ formatCurrency(dashboardStats.pending) }}</h3>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 bg-white p-5 rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                                <h3 class="font-bold text-slate-800 mb-4">Evolução Financeira</h3>
                                <apexchart type="area" height="300" :options="chartOptions.revenue" :series="charts.revenueSeries"></apexchart>
                            </div>
                            <div class="lg:col-span-1 bg-white p-5 rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                                <h3 class="font-bold text-slate-800 mb-4">Top Serviços</h3>
                                <apexchart type="bar" height="300" :options="chartOptions.services" :series="charts.servicesSeries"></apexchart>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: CALENDAR -->
                    <div v-else-if="view === 'calendar'" key="calendar" class="h-full flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-slate-900 hidden md:block">Agenda</h2>
                            <button @click="openApptModal(null)" class="hidden md:flex bg-rose-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg items-center gap-2 hover:bg-rose-700 transition-colors">
                                <i class="ri-add-line text-lg"></i> Novo Horário
                            </button>
                        </div>
                        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm flex-1 overflow-hidden flex flex-col min-h-[500px]">
                            <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                <h3 class="font-bold text-lg capitalize text-slate-800">{{ currentDate.toLocaleDateString('pt-BR', {month:'long'}) }}</h3>
                                <div class="flex gap-2 bg-white rounded-xl border border-slate-200 p-1">
                                    <button @click="changeWeek(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 rounded-lg text-slate-600"><i class="ri-arrow-left-s-line text-xl"></i></button>
                                    <button @click="currentDate = new Date()" class="px-3 text-xs font-bold text-rose-600 uppercase tracking-wide hover:bg-rose-50 rounded-lg">Hoje</button>
                                    <button @click="changeWeek(1)" class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 rounded-lg text-slate-600"><i class="ri-arrow-right-s-line text-xl"></i></button>
                                </div>
                            </div>
                            <div class="flex-1 overflow-auto relative custom-scrollbar bg-slate-50/50">
                                <div class="flex min-w-[700px] md:min-w-full pb-10">
                                    <div class="w-16 border-r bg-white pt-10 sticky left-0 z-20 shadow-sm">
                                        <div v-for="h in hours" :key="h" class="h-24 text-[10px] font-bold text-center text-slate-400 -mt-2 bg-white">{{h}}:00</div>
                                    </div>
                                    <div class="flex-1 flex">
                                        <div v-for="day in weekDays" :key="day.toString()" :class="['flex-1 border-r min-w-[100px] relative bg-white', isToday(day) ? 'bg-rose-50/20' : '']">
                                            <div class="h-10 border-b flex flex-col items-center justify-center sticky top-0 bg-white z-10 shadow-sm">
                                                <span class="text-[9px] font-bold uppercase text-slate-400">{{day.toLocaleDateString('pt-BR',{weekday:'short'})}}</span>
                                                <span :class="['text-sm font-bold', isToday(day) ? 'text-rose-600 bg-rose-100 w-6 h-6 flex items-center justify-center rounded-full' : 'text-slate-900']">{{day.getDate()}}</span>
                                            </div>
                                            <div v-for="h in hours" :key="h" class="h-24 border-b border-slate-100/50"></div>
                                            <div v-for="appt in getApptsForDay(day)" :key="appt.id" 
                                                 @click="openApptModal(appt)"
                                                 :class="['absolute left-1 right-1 rounded-md border-l-[3px] p-2 cursor-pointer hover:brightness-95 transition-all text-xs overflow-hidden shadow-sm z-10', appt.service.color]"
                                                 :style="getApptStyle(appt)">
                                                <div class="font-bold truncate text-[11px]">{{ appt.client.name.split(' ')[0] }}</div>
                                                <div class="opacity-75 truncate text-[10px]">{{ appt.service.name }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: APPOINTMENTS LIST -->
                    <div v-else-if="view === 'appointments'" key="appointments" class="space-y-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <h2 class="text-2xl font-bold text-slate-900">Gerenciar Agendamentos</h2>
                            <div class="flex gap-2 w-full md:w-auto">
                                <select v-model="apptFilter" class="bg-white border border-slate-300 rounded-xl px-4 py-2 text-sm focus:ring-rose-500 outline-none w-full md:w-auto shadow-sm h-12 md:h-auto">
                                    <option value="all">Todos</option>
                                    <option value="scheduled">Agendados</option>
                                    <option value="completed">Concluídos</option>
                                    <option value="canceled">Cancelados</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-slate-100">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase">Data</th>
                                            <th class="px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase">Detalhes</th>
                                            <th class="px-6 py-4 text-center text-xs font-bold text-slate-500 uppercase">Status</th>
                                            <th class="px-6 py-4 text-right text-xs font-bold text-slate-500 uppercase">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr v-for="appt in filteredAppointmentsList" :key="appt.id" class="hover:bg-slate-50 group transition-colors">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-bold text-slate-700">{{ new Date(appt.startTime).toLocaleDateString('pt-BR') }}</div>
                                                <div class="text-xs text-slate-500 font-medium bg-slate-100 inline-block px-1.5 py-0.5 rounded mt-1">
                                                    {{ new Date(appt.startTime).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'}) }}
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="text-sm font-bold text-slate-900">{{ appt.client.name }}</div>
                                                <div class="text-xs text-slate-500 mt-0.5">{{ appt.service.name }}</div>
                                            </td>
                                            <td class="px-6 py-4 text-center">
                                                <span v-if="appt.status === 'completed'" class="bg-green-100 text-green-700 border border-green-200 text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wider">Concluído</span>
                                                <span v-else-if="appt.status === 'canceled'" class="bg-gray-100 text-gray-500 border border-gray-200 text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wider">Cancelado</span>
                                                <span v-else class="bg-blue-50 text-blue-700 border border-blue-100 text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wider">Agendado</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button v-if="appt.status !== 'completed'" @click="updateApptStatus(appt, 'completed')" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-green-200 bg-white hover:bg-green-50 text-green-600 text-xs font-bold transition-all shadow-sm" title="Concluir">
                                                        <i class="ri-check-line text-sm"></i>
                                                    </button>
                                                    <button v-if="appt.status !== 'canceled'" @click="updateApptStatus(appt, 'canceled')" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-red-200 bg-white hover:bg-red-50 text-red-600 text-xs font-bold transition-all shadow-sm" title="Cancelar">
                                                        <i class="ri-close-line text-sm"></i>
                                                    </button>
                                                    <button @click="openApptModal(appt)" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold transition-all shadow-sm" title="Editar">
                                                        <i class="ri-pencil-line text-sm"></i>
                                                    </button>
                                                    <button @click="deleteAppointment(appt.id)" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 bg-white hover:bg-slate-100 text-slate-400 hover:text-rose-600 text-xs font-bold transition-all shadow-sm" title="Excluir">
                                                        <i class="ri-delete-bin-line text-sm"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: FINANCIAL -->
                    <div v-else-if="view === 'financial'" key="financial" class="space-y-6">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-slate-900">Financeiro</h2>
                            <div class="bg-white border border-slate-200 p-1 rounded-xl flex w-full md:w-auto shadow-sm">
                                <button @click="financialTab = 'income'" :class="['flex-1 md:flex-none px-6 py-2 rounded-lg text-sm font-bold transition-all', financialTab === 'income' ? 'bg-rose-500 text-white shadow-md' : 'text-slate-500 hover:text-slate-700']">Entradas</button>
                                <button @click="financialTab = 'expenses'" :class="['flex-1 md:flex-none px-6 py-2 rounded-lg text-sm font-bold transition-all', financialTab === 'expenses' ? 'bg-rose-500 text-white shadow-md' : 'text-slate-500 hover:text-slate-700']">Saídas</button>
                            </div>
                        </div>

                        <div v-if="financialTab === 'income'" class="space-y-4">
                            <div v-for="(group, month) in financialGroups" :key="month" class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                                <div class="bg-slate-50 px-4 py-3 border-b border-slate-200 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-700 flex items-center gap-2 text-sm"><i class="ri-calendar-line"></i> {{ month }}</h3>
                                    <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded border border-emerald-100">{{ formatCurrency(group.total) }}</span>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-slate-100">
                                        <thead class="bg-white">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-slate-400 uppercase">Dia</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-slate-400 uppercase">Cliente</th>
                                                <th class="px-4 py-3 text-right text-xs font-bold text-slate-400 uppercase">Valor</th>
                                                <th class="px-4 py-3 text-center text-xs font-bold text-slate-400 uppercase">Status</th>
                                                <th class="px-4 py-3"></th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-50">
                                            <tr v-for="appt in group.items" :key="appt.id" class="hover:bg-slate-50 cursor-pointer" @click="openPaymentModal(appt)">
                                                <td class="px-4 py-3 text-sm font-medium text-slate-600">{{ new Date(appt.startTime).getDate() }}</td>
                                                <td class="px-4 py-3 text-sm text-slate-800">{{ appt.client.name }} <span class="text-xs text-slate-400 block">{{ appt.service.name }}</span></td>
                                                <td class="px-4 py-3 text-sm text-right font-bold text-slate-700">{{ formatCurrency(appt.price) }}</td>
                                                <td class="px-4 py-3 text-center">
                                                    <span v-if="appt.paymentStatus === 'paid'" class="bg-emerald-100 text-emerald-700 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Pago</span>
                                                    <span v-else class="bg-rose-100 text-rose-700 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Pendente</span>
                                                </td>
                                                <td class="px-4 py-3 text-right text-slate-400">
                                                    <button class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-white text-slate-600 text-xs font-bold transition-all shadow-sm ml-auto">
                                                        <i class="ri-pencil-line"></i> Editar
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div v-else class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1 bg-white p-5 rounded-2xl border border-slate-200 shadow-sm h-fit">
                                <h3 class="font-bold text-slate-900 mb-4">Nova Despesa</h3>
                                <form @submit.prevent="saveExpense" class="space-y-3">
                                    <input v-model="expenseForm.description" placeholder="Descrição" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none h-12">
                                    <div class="grid grid-cols-2 gap-3">
                                        <input v-model="expenseForm.amount" type="number" placeholder="Valor" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none h-12">
                                        <input v-model="expenseForm.date" type="date" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none h-12">
                                    </div>
                                    <select v-model="expenseForm.category" class="w-full border border-slate-300 p-3 rounded-xl text-sm bg-white focus:ring-2 focus:ring-rose-500 outline-none h-12">
                                        <option value="product">Produtos</option>
                                        <option value="rent">Aluguel</option>
                                        <option value="marketing">Marketing</option>
                                        <option value="other">Outros</option>
                                    </select>
                                    <button type="submit" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold text-sm hover:bg-slate-800 shadow-lg h-12">Salvar</button>
                                </form>
                            </div>
                            <div class="lg:col-span-2 bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                                <table class="min-w-full divide-y divide-slate-100">
                                    <thead class="bg-slate-50"><tr><th class="px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase">Data</th><th class="px-4 py-3 text-left text-xs font-bold text-slate-500 uppercase">Desc.</th><th class="px-4 py-3 text-right text-xs font-bold text-slate-500 uppercase">Valor</th></tr></thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr v-for="exp in expenses" :key="exp.id" class="hover:bg-slate-50">
                                            <td class="px-4 py-3 text-sm text-slate-500">{{ new Date(exp.date).toLocaleDateString('pt-BR') }}</td>
                                            <td class="px-4 py-3 text-sm font-medium text-slate-800">{{ exp.description }}</td>
                                            <td class="px-4 py-3 text-sm font-bold text-rose-600 text-right">- {{ formatCurrency(exp.amount) }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: CLIENTS AND SERVICES -->
                    <div v-else-if="view === 'clients' || view === 'services'" :key="view" class="space-y-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <h2 class="text-2xl font-bold text-slate-900 capitalize">{{ view === 'clients' ? 'Clientes' : 'Serviços' }}</h2>
                            <button @click="view === 'clients' ? openClientModal({}) : openServiceModal({})" class="w-full md:w-auto bg-slate-900 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg hover:bg-slate-800 transition-colors">
                                + Adicionar {{ view === 'clients' ? 'Cliente' : 'Serviço' }}
                            </button>
                        </div>
                        <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                            <div class="divide-y divide-slate-100">
                                <div v-for="item in (view === 'clients' ? clients : services)" :key="item.id" class="p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center hover:bg-slate-50 transition-colors group">
                                    <div @click="view === 'clients' ? openClientModal(item) : openServiceModal(item)" class="flex-1 cursor-pointer w-full">
                                        <div class="font-bold text-slate-800">{{ item.name }}</div>
                                        <div class="text-xs text-slate-500 mt-1">{{ view === 'clients' ? item.phone : formatCurrency(item.price) }}</div>
                                    </div>
                                    <div class="flex gap-2 mt-3 sm:mt-0 w-full sm:w-auto justify-end">
                                        <button @click="view === 'clients' ? openClientModal(item) : openServiceModal(item)" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-white text-slate-600 text-xs font-bold transition-all shadow-sm">
                                            <i class="ri-pencil-line"></i> Editar
                                        </button>
                                        <button @click="view === 'clients' ? deleteClient(item.id) : deleteService(item.id)" class="flex items-center gap-1 px-3 py-1.5 rounded-lg border border-red-100 hover:bg-red-50 text-red-500 text-xs font-bold transition-all shadow-sm">
                                            <i class="ri-delete-bin-line"></i> Excluir
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>

                <!-- FAB MOBILE (Novo Agendamento) -->
                <button v-if="['dashboard', 'calendar'].includes(view)" @click="openApptModal(null)" class="md:hidden fixed bottom-6 right-6 w-14 h-14 bg-rose-600 text-white rounded-full shadow-xl shadow-rose-300 flex items-center justify-center z-50 active:scale-90 transition-transform">
                    <i class="ri-add-line text-2xl"></i>
                </button>
            </div>
        </main>

        <!-- MODAIS REORGANIZADOS PARA EVITAR CONFLITOS -->

        <!-- Camada 1: Agendamento (z-50) -->
        <transition name="fade">
            <div v-if="modals.appointment.open" class="fixed inset-0 z-50 flex items-center justify-center p-4">
                <!-- Backdrop específico do modal de agendamento -->
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="modals.appointment.open = false"></div>
                
                <div class="relative bg-white rounded-3xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl animate-scale-in z-10">
                    <div class="p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-3xl">
                        <h3 class="font-bold text-lg text-slate-900">{{ modals.appointment.id ? 'Editar' : 'Novo' }} Agendamento</h3>
                        <button @click="modals.appointment.open = false" class="w-8 h-8 flex items-center justify-center rounded-full bg-white border border-slate-200 hover:bg-slate-50 text-slate-500 transition-colors">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    <div class="p-6 overflow-y-auto flex-1 custom-scrollbar space-y-5">
                        <!-- Cliente Select -->
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-2">Cliente</label>
                            <div class="flex gap-2">
                                <select v-model="apptForm.clientId" class="flex-1 bg-white border border-slate-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-rose-500 outline-none h-12">
                                    <option value="" disabled>Selecione...</option>
                                    <option v-for="c in clients" :key="c.id" :value="c.id">{{ c.name }}</option>
                                </select>
                                <button @click="openClientModal({})" class="w-12 h-12 flex items-center justify-center bg-rose-50 text-rose-600 rounded-xl border border-rose-100 hover:bg-rose-100 transition-colors">
                                    <i class="ri-user-add-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Itens (Batch) -->
                        <div class="space-y-3">
                            <label class="block text-sm font-bold text-slate-700">Serviços</label>
                            <div v-for="(item, idx) in apptForm.batchItems" :key="idx" class="bg-slate-50 p-4 rounded-2xl border border-slate-200 relative group">
                                <button v-if="apptForm.batchItems.length > 1" @click="apptForm.batchItems.splice(idx, 1)" class="absolute -top-2 -right-2 w-7 h-7 flex items-center justify-center bg-white text-rose-500 border border-rose-200 rounded-full shadow-sm hover:bg-rose-50">
                                    <i class="ri-close-line"></i>
                                </button>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                    <select v-model="item.serviceId" @change="updateBatchItemPrice(item)" class="bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none h-12">
                                        <option value="">Serviço...</option>
                                        <option v-for="s in services" :key="s.id" :value="s.id">{{ s.name }}</option>
                                    </select>
                                    <input type="number" v-model="item.price" class="bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none h-12" placeholder="Valor">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="date" v-model="item.date" class="bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none h-12">
                                    <input type="time" v-model="item.time" class="bg-white border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none h-12">
                                </div>
                            </div>
                            <button v-if="!modals.appointment.id" @click="addBatchItem" class="w-full py-3 border-2 border-dashed border-slate-200 rounded-xl text-slate-500 text-sm font-bold hover:border-rose-300 hover:text-rose-500 transition-colors flex items-center justify-center gap-2 h-12">
                                <i class="ri-add-line"></i> Adicionar Outro Serviço
                            </button>
                        </div>
                    </div>
                    <div class="p-5 border-t border-slate-100 bg-slate-50 rounded-b-3xl">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-slate-600 font-medium">Total Estimado:</span>
                            <span class="text-2xl font-bold text-slate-900">{{ formatCurrency(batchTotal) }}</span>
                        </div>
                        <div class="flex gap-3">
                             <button @click="modals.appointment.open = false" class="flex-1 py-3 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition-colors h-12">
                                Cancelar
                            </button>
                            <button @click="saveBatchAppointment" class="flex-1 py-3 bg-slate-900 text-white rounded-xl font-bold shadow-lg hover:bg-slate-800 transform active:scale-95 transition-all h-12">
                                Confirmar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Camada 2: Pagamentos e Cadastros Rápidos (z-60 - Acima do agendamento) -->
        <transition name="fade">
            <div v-if="modals.payment.open || modals.client.open || modals.service.open" class="fixed inset-0 z-[60] flex items-center justify-center p-4">
                
                <!-- Backdrop Superior -->
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="modals.payment.open = modals.client.open = modals.service.open = false"></div>

                <!-- Modal Pagamento -->
                <div v-if="modals.payment.open" class="relative bg-white rounded-3xl w-full max-w-md shadow-2xl overflow-hidden animate-scale-in z-10">
                    <div class="p-5 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="font-bold text-lg text-slate-900">Pagamento</h3>
                        <button @click="modals.payment.open = false" class="w-8 h-8 flex items-center justify-center rounded-full bg-white border border-slate-200 hover:bg-slate-50 text-slate-500 transition-colors">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                    <!-- Conteúdo Pagamento (Mantido) -->
                    <div class="p-6 space-y-6">
                        <div class="grid grid-cols-3 gap-3 text-center">
                            <div class="bg-slate-50 p-2 rounded-xl border border-slate-200"><p class="text-[10px] uppercase font-bold text-slate-400">Total</p><p class="font-bold text-slate-900">{{ formatCurrency(modals.payment.appt?.price) }}</p></div>
                            <div class="bg-emerald-50 p-2 rounded-xl border border-emerald-100"><p class="text-[10px] uppercase font-bold text-emerald-600">Pago</p><p class="font-bold text-emerald-700">{{ formatCurrency(modals.payment.appt?.paidAmount) }}</p></div>
                            <div class="bg-rose-50 p-2 rounded-xl border border-rose-100"><p class="text-[10px] uppercase font-bold text-rose-600">Falta</p><p class="font-bold text-rose-700">{{ formatCurrency(Math.max(0, (modals.payment.appt?.price || 0) - (modals.payment.appt?.paidAmount || 0))) }}</p></div>
                        </div>
                         <div>
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2">Histórico</h4>
                            <div class="bg-slate-50 rounded-xl p-2 max-h-32 overflow-y-auto space-y-2 border border-slate-100">
                                <div v-for="tx in (modals.payment.appt?.transactions || [])" :key="tx.id" class="flex justify-between items-center text-sm p-2 bg-white rounded-lg border border-slate-200 shadow-sm">
                                    <span class="font-bold text-emerald-600">{{ formatCurrency(tx.amount) }}</span>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-slate-400">{{ new Date(tx.date).toLocaleDateString() }}</span>
                                        <button @click="deleteTransaction(tx.id)" class="text-rose-400 hover:text-rose-600 p-1 hover:bg-rose-50 rounded"><i class="ri-delete-bin-line"></i></button>
                                    </div>
                                </div>
                                <div v-if="!modals.payment.appt?.transactions?.length" class="text-center text-xs text-slate-400 py-4">Nenhum pagamento registrado.</div>
                            </div>
                        </div>
                         <div class="pt-4 border-t border-slate-100">
                            <div class="flex gap-2 mb-3">
                                <div class="flex-1">
                                    <label class="text-[10px] font-bold uppercase text-slate-400">Valor</label>
                                    <input type="number" v-model="paymentForm.amount" class="w-full border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 h-10">
                                </div>
                                <div class="w-32">
                                    <label class="text-[10px] font-bold uppercase text-slate-400">Data</label>
                                    <input type="date" v-model="paymentForm.date" class="w-full border border-slate-300 rounded-xl px-3 py-2 text-sm outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 h-10">
                                </div>
                            </div>
                            <button @click="addTransaction" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-emerald-700 transition-colors h-12">Registrar Pagamento</button>
                        </div>
                    </div>
                </div>

                <!-- Modal Genérico Cliente/Serviço -->
                <div v-if="modals.client.open || modals.service.open" class="relative bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-in z-10">
                    <button @click="modals.client.open = modals.service.open = false" class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center bg-slate-100 rounded-full hover:bg-slate-200 text-slate-500 transition-colors">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                    
                    <h3 class="font-bold text-xl mb-6 text-slate-900">{{ modals.client.open ? 'Cliente' : 'Serviço' }}</h3>
                    
                    <form v-if="modals.client.open" @submit.prevent="saveClient" class="space-y-4">
                        <input v-model="simpleForm.name" placeholder="Nome" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none transition-all h-12">
                        <input v-model="simpleForm.phone" placeholder="Telefone" class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none transition-all h-12">
                        <div class="flex gap-3 pt-2">
                            <button type="button" @click="modals.client.open=false" class="flex-1 py-3 bg-white border border-slate-200 font-bold text-slate-600 rounded-xl hover:bg-slate-50 transition-colors h-12">Cancelar</button>
                            <button type="submit" class="flex-1 py-3 bg-slate-900 text-white font-bold rounded-xl shadow-lg hover:bg-slate-800 transition-colors h-12">Salvar</button>
                        </div>
                    </form>

                    <form v-if="modals.service.open" @submit.prevent="saveService" class="space-y-4">
                        <input v-model="simpleForm.name" placeholder="Nome" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none transition-all h-12">
                        <div class="grid grid-cols-2 gap-3">
                            <input v-model="simpleForm.price" type="number" placeholder="Preço" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none transition-all h-12">
                            <input v-model="simpleForm.duration" type="number" placeholder="Minutos" required class="w-full border border-slate-300 p-3 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 outline-none transition-all h-12">
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button type="button" @click="modals.service.open=false" class="flex-1 py-3 bg-white border border-slate-200 font-bold text-slate-600 rounded-xl hover:bg-slate-50 transition-colors h-12">Cancelar</button>
                            <button type="submit" class="flex-1 py-3 bg-slate-900 text-white font-bold rounded-xl shadow-lg hover:bg-slate-800 transition-colors h-12">Salvar</button>
                        </div>
                    </form>
                </div>
            </div>
        </transition>

    </div>
    
    <!-- INCLUIR JAVASCRIPT -->
    <?!= include('JS'); ?>

</body>
</html>
